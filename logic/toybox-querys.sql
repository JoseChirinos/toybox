USE toybox_db;

-- Values for User
INSERT INTO user VALUES (null,'Gentry','Sheppard','gentrysheppard@orbin.com','+1 (913) 531-2378','blue','http://placehold.it/32x32',false,'2017-06-26 03:16:25');
INSERT INTO user VALUES (null,'Britt','Chang','brittchang@orbin.com','+1 (818) 533-3949','green','http://placehold.it/32x32',true,'2017-11-01 02:51:38');
INSERT INTO user VALUES (null,'Shauna','Weber','shaunaweber@orbin.com','+1 (827) 586-2184','blue','http://placehold.it/32x32',false,'2017-10-30 11:45:03');
INSERT INTO user VALUES (null,'Kate','Melton','katemelton@orbin.com','+1 (868) 505-3576','green','http://placehold.it/32x32',true,'2017-02-01 09:45:16');
INSERT INTO user VALUES (null,'Iris','Caldwell','iriscaldwell@orbin.com','+1 (941) 540-3846','green','http://placehold.it/32x32',true,'2017-01-13 12:04:47');
INSERT INTO user VALUES (null,'Tracey','Huff','traceyhuff@orbin.com','+1 (875) 535-3017','green','http://placehold.it/32x32',true,'2017-08-02 09:36:01');
INSERT INTO user VALUES (null,'Hutchinson','Jefferson','hutchinsonjefferson@orbin.com','+1 (821) 508-2178','brown','http://placehold.it/32x32',false,'2017-06-14 10:00:59');

-- Values for warehouse
INSERT INTO warehouse VALUES (null,'Almacen barkarama','571 Hamilton Avenue, Cashtown, North Dakota, 9558','69.872912,-36.027281','538','92','2017-10-15 03:51:01');
INSERT INTO warehouse VALUES (null,'Almacen obones','863 Grand Street, Nash, Alaska, 4671','-8.213053,115.340827','401','72','2014-04-15 04:49:01');
INSERT INTO warehouse VALUES (null,'Almacen genmom','801 Paerdegat Avenue, Gilgo, Northern Mariana Islands, 9948','-60.138109,-13.096619','847','77','2015-05-08 04:49:11');
INSERT INTO warehouse VALUES (null,'Almacen applideck','205 Bay Parkway, Wolcott, Texas, 8863','43.505109,-42.524707','294','10','2014-12-04 12:46:50');
INSERT INTO warehouse VALUES (null,'Almacen zyple','395 Cox Place, Omar, Iowa, 7991','-53.056332,42.035638','471','49','2016-11-13 10:10:45');
INSERT INTO warehouse VALUES (null,'Almacen geekology','951 Tapscott Street, Brantleyville, Arkansas, 6411','47.685335,-75.979071','602','55','2016-06-20 09:32:02');
INSERT INTO warehouse VALUES (null,'Almacen prosely','471 Barbey Street, Harold, Marshall Islands, 5031','-35.928367,36.990917','621','54','2015-05-30 04:12:41');

-- Values for product
INSERT INTO product VALUES (null,'Toy SCHOOLIO brown','60','230','http://placehold.it/320x320','2274564','6','2016-05-04 06:33:31');
INSERT INTO product VALUES (null,'Toy WARETEL blue','48','355','http://placehold.it/320x320','4492372','1','2014-10-07 02:46:56');
INSERT INTO product VALUES (null,'Toy VELITY blue','90','75','http://placehold.it/320x320','9580688','4','2015-01-05 03:17:47');
INSERT INTO product VALUES (null,'Toy PARCOE blue','89','324','http://placehold.it/320x320','9641257','6','2017-06-14 03:47:31');
INSERT INTO product VALUES (null,'Toy QUANTALIA blue','81','156','http://placehold.it/320x320','1609433','6','2017-06-27 11:00:36');
INSERT INTO product VALUES (null,'Toy PORTICA blue','43','309','http://placehold.it/320x320','4915244','2','2014-01-19 02:16:29');
INSERT INTO product VALUES (null,'Toy DECRATEX blue','87','38','http://placehold.it/320x320','4930833','7','2015-06-14 04:20:05');
INSERT INTO product VALUES (null,'Toy KNEEDLES brown','61','407','http://placehold.it/320x320','3810221','7','2017-10-03 08:18:59');
INSERT INTO product VALUES (null,'Toy KAGGLE brown','21','417','http://placehold.it/320x320','9861933','4','2017-03-09 07:45:44');
INSERT INTO product VALUES (null,'Toy VISALIA green','29','54','http://placehold.it/320x320','1459640','3','2015-02-14 08:05:04');
INSERT INTO product VALUES (null,'Toy TOURMANIA blue','70','289','http://placehold.it/320x320','9843861','4','2017-06-18 02:45:12');
INSERT INTO product VALUES (null,'Toy GENMY brown','96','398','http://placehold.it/320x320','6632522','3','2017-07-11 08:15:17');
INSERT INTO product VALUES (null,'Toy VORATAK brown','93','157','http://placehold.it/320x320','3620553','6','2017-11-21 10:03:28');
INSERT INTO product VALUES (null,'Toy DRAGBOT blue','67','191','http://placehold.it/320x320','9772577','7','2015-10-14 07:25:36');
INSERT INTO product VALUES (null,'Toy MAGMINA green','53','423','http://placehold.it/320x320','2444149','5','2014-01-13 12:10:51');
INSERT INTO product VALUES (null,'Toy ILLUMITY blue','31','413','http://placehold.it/320x320','1239373','6','2015-02-06 06:17:54');
INSERT INTO product VALUES (null,'Toy GALLAXIA blue','69','201','http://placehold.it/320x320','1679144','1','2014-08-30 02:47:26');
INSERT INTO product VALUES (null,'Toy BEADZZA brown','97','120','http://placehold.it/320x320','5573470','7','2014-07-12 01:50:59');
INSERT INTO product VALUES (null,'Toy GEEKOLOGY blue','59','384','http://placehold.it/320x320','5792467','4','2016-05-15 12:21:41');
INSERT INTO product VALUES (null,'Toy GAZAK brown','44','305','http://placehold.it/320x320','7688911','6','2016-06-15 07:23:40');
INSERT INTO product VALUES (null,'Toy ACCUPHARM brown','77','37','http://placehold.it/320x320','3975250','2','2017-10-02 10:52:16');
INSERT INTO product VALUES (null,'Toy MOBILDATA blue','28','42','http://placehold.it/320x320','6234353','4','2014-01-22 06:43:12');
INSERT INTO product VALUES (null,'Toy SOLGAN green','25','400','http://placehold.it/320x320','4838280','4','2017-11-02 11:46:13');
INSERT INTO product VALUES (null,'Toy YURTURE brown','54','104','http://placehold.it/320x320','3594434','7','2016-06-19 01:33:28');
INSERT INTO product VALUES (null,'Toy ZOLARITY blue','19','239','http://placehold.it/320x320','9450228','4','2014-01-10 12:08:14');
INSERT INTO product VALUES (null,'Toy ZENTILITY green','92','207','http://placehold.it/320x320','9342828','5','2017-06-10 08:14:56');
INSERT INTO product VALUES (null,'Toy IRACK blue','68','363','http://placehold.it/320x320','6228315','5','2017-10-15 01:37:50');
INSERT INTO product VALUES (null,'Toy NETILITY brown','89','133','http://placehold.it/320x320','7576530','7','2014-07-27 10:44:45');
INSERT INTO product VALUES (null,'Toy LOTRON blue','79','429','http://placehold.it/320x320','7733836','3','2015-07-18 06:16:06');
INSERT INTO product VALUES (null,'Toy PROGENEX green','10','71','http://placehold.it/320x320','4205427','2','2017-10-20 06:28:15');
INSERT INTO product VALUES (null,'Toy ICOLOGY blue','89','33','http://placehold.it/320x320','1264960','3','2015-04-09 12:02:14');
INSERT INTO product VALUES (null,'Toy EXOSIS brown','81','399','http://placehold.it/320x320','3895156','3','2016-04-22 08:49:25');
INSERT INTO product VALUES (null,'Toy RONBERT brown','50','226','http://placehold.it/320x320','1353754','7','2017-06-02 11:28:18');
INSERT INTO product VALUES (null,'Toy XEREX brown','12','239','http://placehold.it/320x320','4961951','1','2014-04-18 10:40:46');
INSERT INTO product VALUES (null,'Toy ISOTRONIC blue','22','44','http://placehold.it/320x320','6673782','4','2015-06-23 11:14:09');
INSERT INTO product VALUES (null,'Toy AQUAMATE green','22','106','http://placehold.it/320x320','4298892','1','2017-07-24 12:01:59');
INSERT INTO product VALUES (null,'Toy BUZZOPIA blue','47','352','http://placehold.it/320x320','7607363','4','2014-07-13 04:58:45');
INSERT INTO product VALUES (null,'Toy REALMO blue','66','232','http://placehold.it/320x320','5448843','4','2017-04-06 07:56:30');
INSERT INTO product VALUES (null,'Toy HIVEDOM brown','38','32','http://placehold.it/320x320','7954719','3','2014-05-07 02:53:29');
INSERT INTO product VALUES (null,'Toy GAPTEC green','76','293','http://placehold.it/320x320','1549745','6','2016-08-11 05:08:03');
INSERT INTO product VALUES (null,'Toy OMATOM green','11','56','http://placehold.it/320x320','2654191','2','2014-10-14 07:13:31');
INSERT INTO product VALUES (null,'Toy ACLIMA brown','39','402','http://placehold.it/320x320','5385590','2','2014-05-20 11:51:21');
INSERT INTO product VALUES (null,'Toy PHARMEX blue','43','41','http://placehold.it/320x320','9005823','1','2014-05-05 03:44:57');
INSERT INTO product VALUES (null,'Toy DIGIGENE blue','74','168','http://placehold.it/320x320','3345378','2','2015-06-06 10:10:32');
INSERT INTO product VALUES (null,'Toy ZILLACTIC blue','13','355','http://placehold.it/320x320','1214718','1','2014-10-05 01:08:12');
INSERT INTO product VALUES (null,'Toy MAGNEATO green','80','92','http://placehold.it/320x320','9383143','4','2017-02-18 07:08:45');
INSERT INTO product VALUES (null,'Toy ZBOO blue','24','140','http://placehold.it/320x320','5280372','7','2017-11-26 11:12:09');
INSERT INTO product VALUES (null,'Toy ORBEAN brown','31','126','http://placehold.it/320x320','3512281','3','2015-10-05 04:18:04');
INSERT INTO product VALUES (null,'Toy SURELOGIC green','53','157','http://placehold.it/320x320','4018360','2','2016-01-09 11:33:00');
INSERT INTO product VALUES (null,'Toy TERRASYS green','45','63','http://placehold.it/320x320','9425187','5','2015-04-15 12:03:18');


SELECT w.id, w.name, w.address, w.gps, w.max_capacity, w.min_capacity, w.date_init FROM warehouse_branch as wb 
INNER JOIN warehouse as w 
ON wb.id_warehouse = w.id
WHERE wb.id_user = 8;

-- Procedimiento Almacenado para ver los almacenes de un usuario

DROP PROCEDURE IF EXISTS allWarehouse;

DELIMITER $$
	
    -- the code is here
    CREATE PROCEDURE allWarehouse(
		IN _id_user INT,
        IN _limit INT,
        IN _offset INT
    )
    BEGIN
		SELECT w.id, w.name, w.address, w.gps, w.max_capacity, w.min_capacity, w.date_init FROM warehouse_branch as wb 
		INNER JOIN warehouse as w 
		ON wb.id_warehouse = w.id
		WHERE wb.id_user = _id_user order by w.id DESC LIMIT _limit OFFSET _offset;
    END
$$
CALL allWarehouse(1,5,0);


DROP PROCEDURE IF EXISTS insertWarehouse;

DELIMITER $$
	
    -- the code is here
    CREATE PROCEDURE insertWarehouse(
		IN _userId INT,
        IN _name VARCHAR(150),
        IN _address VARCHAR(250),
        IN _gps VARCHAR(250),
        IN _max INT,
        IN _min INT
    )
    BEGIN
		DECLARE _idWarehouseInsert INT DEFAULT -1;
        
		INSERT INTO warehouse VALUES (null,_name,_address,_gps,_max,_min,NOW());
        SET _idWarehouseInsert = last_insert_id();
        INSERT INTO warehouse_branch VALUES (null, _idWarehouseInsert,_userId);
        SELECT _idWarehouseInsert as idInsertado;        
    END
$$

CALL insertWarehouse(8,'Almacen de Prueba','Calle San Alberto #361','19.15184,19.26897',100,15)


DROP PROCEDURE IF EXISTS allProduct;

DELIMITER $$
	
    -- the code is here
    CREATE PROCEDURE allProduct(
		IN _id_warehouse INT,
        IN _limit INT,
        IN _offset INT
    )
    BEGIN
		SELECT p.id,p.name,p.quantity,p.price,p.picture_url,p.barcode, u.name as name_registry, u.last_name as last_name_registry FROM product as p 
		INNER JOIN warehouse as w 
		ON p.id_warehouse = w.id
		INNER JOIN user as u
		ON u.id = p.id_user_registry
		WHERE w.id = _id_warehouse order by w.id DESC LIMIT _limit OFFSET _offset;
    END
$$
CALL allProduct(1,5,5);

DROP PROCEDURE IF EXISTS insertProduct;

DELIMITER $$
	
    -- the code is here
    CREATE PROCEDURE insertProduct(
		IN _name VARCHAR(150),
        IN _quantity INT,
        IN _price FLOAT,
        IN _picture_url VARCHAR(250),
        IN _barcode VARCHAR(200),
        IN _id_user_registry INT,
        IN _id_warehouse INT
    )
    BEGIN
		DECLARE _idProductInsert INT DEFAULT -1;
        
		INSERT INTO product VALUES (null,_name,_quantity,_price,_picture_url,_barcode,_id_user_registry,_id_warehouse,NOW());
        SET _idProductInsert = last_insert_id();
        SELECT _idProductInsert as idInsertado;        
    END
$$

CALL insertProduct('Beatiful Princess Muñeca',25,75.5,'http://placehold.it/320x320','6934247534834',8,7)
